---
import Image from "astro/components/Image.astro";
const getCurrentMonthYear = () => {
    const date = new Date();
    const month = date.getMonth() + 1; // getMonth() returns 0-11, so add 1 for 1-12
    const year = date.getFullYear();
    return { month, year };
};

const formatCurrency = (amount: any) => {
    return amount.toLocaleString("vi-VN");
};

const { month, year } = getCurrentMonthYear();

const { zalo } = Astro.props;

// Thay thế fetchApi bằng dữ liệu mẫu cố định
const Combos = [
    {
        id: 1,
        attributes: {
            nhom_combo: "Off-Grid",
            pha: "1 pha",
            cong_suat: 5,
            slug: "off-grid-1p-ja-55-solis-5-easyway-5",
            tilte: "Combo Hybrid 5kW 1 pha",
            gia_niem_yet: 84000000,
            san_luong: "500-600",
            hoan_von: "47 tháng",
            dien_tich: 24,
            feature: 1,
            image: {
                data: {
                    attributes: {
                        formats: {
                            small: {
                                url: "/images/Hybrid-1-pha.jpg"

                            }
                        }
                    }
                }
            }
        }
    },
    {
        id: 2,
        attributes: {
            nhom_combo: "Off-Grid",
            pha: "1 pha",
            cong_suat: 15.6,
            slug: "off-grid-1p-ja-88-solis-5-easyway-5",
            tilte: "Combo Hybrid 11kW 1 pha",
            gia_niem_yet: 189100000,
            san_luong: "1600-1900",
            hoan_von: "33 tháng",
            dien_tich: 78,
            feature: 1,
            image: {
                data: {
                    attributes: {
                        formats: {
                            small: {
                                url: "/images/Hybrid-1-pha.jpg"
                            }
                        }
                    }
                }
            }
        }
    },
    {
        id: 3,
        attributes: {
            nhom_combo: "Off-Grid",
            pha: "3 pha áp thấp",
            cong_suat: 10.2,
            slug: "off-grid-3p-ja-110-deye-12-easyway-5-ap-thap",
            tilte: "Combo Hybrid 10.2kW 3 pha áp thấp",
            gia_niem_yet: 149300000,
            san_luong: "1000-1300",
            hoan_von: "40 tháng",
            dien_tich: 51,
            feature: 1,
            image: {
                data: {
                    attributes: {
                        formats: {
                            small: {
                                url: "/images/Hybrid-3-pha.jpg"
                            }
                        }
                    }
                }
            }
        }
    },
    {
        id: 4,
        attributes: {
            nhom_combo: "Off-Grid",
            pha: "3 pha áp cao",
            cong_suat: 10.2,
            slug: "off-grid-3p-ja-110-solis-10-easyway-10-ap-cao",
            tilte: "Combo Hybrid 10.2kW 3 pha áp cao",
            gia_niem_yet: 173800000,
            san_luong: "1000-1300",
            hoan_von: "46 tháng",
            dien_tich: 51,
            feature: 1,
            image: {
                data: {
                    attributes: {
                        formats: {
                            small: {
                                url: "/images/Hybrid-3-pha.jpg"
                            }
                        }
                    }
                }
            }
        }
    }
];

// Lọc dữ liệu dựa trên nhom_combo
const filteredCombos = Combos.filter(combo => 
  combo.attributes.nhom_combo === "Off-Grid" && combo.attributes.feature === 1
);

const combos = [
    {
        heading: "Hệ độc lập off-grid",
        background: "bg-slate-100",
        hedien: "Off-Grid",
        hediencss: "bg-green-600",
    },
];

---

<div class="bg-slate-10 block md:hidden">
    <div class="relative isolate">
        <svg
            class="absolute inset-0 -z-10 h-full w-full stroke-gray-200 [mask-image:radial-gradient(100%_100%_at_top_right,white,transparent)]"
            aria-hidden="true"
        >
            <defs>
                <pattern
                    id="83fd4e5a-9d52-42fc-97b6-718e5d7ee527"
                    width="200"
                    height="200"
                    x="50%"
                    y="-1"
                    patternUnits="userSpaceOnUse"
                >
                    <path d="M100 200V.5M.5 .5H200" fill="none"></path>
                </pattern>
            </defs>
            <svg x="50%" y="-1" class="overflow-visible fill-gray-50">
                <path
                    d="M-100.5 0h201v201h-201Z M699.5 0h201v201h-201Z M499.5 400h201v201h-201Z M-300.5 600h201v201h-201Z"
                    stroke-width="0"></path>
            </svg>
            <rect
                width="100%"
                height="100%"
                stroke-width="0"
                fill="url(#83fd4e5a-9d52-42fc-97b6-718e5d7ee527)"></rect>
        </svg>
        <div
            class="mx-auto max-w-7xl px-6 pt-16 sm:py-32 lg:flex lg:items-center lg:gap-x-10 lg:px-8 lg:pt-16 lg:pb-6"
        >
            <div class="mx-auto max-w-2xl lg:mx-0 lg:flex-auto">
           
                <h1
                class="block lg:hidden max-w-lg text-4xl font-bold tracking-tight text-gray-900 sm:text-4xl"
            >
                Hệ thống<br /> Điện mặt trời<br /> Độc lập
                Off-Grid
            </h1>
            <h1
                class="sm:hidden hidden lg:block max-w-lg text-4xl font-bold tracking-tight text-gray-900 sm:text-4xl"
            >
                Hệ thống điện mặt trời<br /> Độc lập
                Off-Grid
            </h1>

                <p class="mt-6 text-xl w-4/5 leading-8 text-gray-600">
                    Hệ thống điện mặt trời Off-Grid, có bao gồm Pin lưu trữ
                    Lithium, nên có thể vận hành độc lập với nguồn lưới điện. Do
                    vậy, khi mất điện lưới, hệ thống sẽ tự động vận hành dựa
                    trên nguồn điện từ Pin Lithium.
                </p>
            </div>
            <div class="mt-8 sm:mt-6 lg:mt-0 lg:flex-shrink-0 lg:flex-grow">
                <img
                    src="/images/off-grid.png"
                    alt="App screenshot"
                    class="mx-auto w-[22.875rem] max-w-full drop-shadow-xl"
                />
            </div>
        </div>
    </div>
    
    <!-- Phần code trực tiếp từ component Combomobile -->
    <div class="pt-6 py-4">
        <div class="mx-auto max-w-7xl ">
            <ul
                role="list"
                class="mx-auto mt-6 grid max-w-2xl grid-cols-1 xl:gap-4 gap-8 md:max-w-2xl md:grid-cols-2 lg:max-w-4xl xl:mx-0 xl:max-w-none xl:grid-cols-4"
            >
            {filteredCombos.map((combo, index) => (
                <div>
                    <li class="rounded-2xl bg-white xl:px-4 xl:py-4 sm:mx-6 mx-6 lg:mx-0  px-4 py-4">
                        <ul role="list" class="my-4 flex justify-between gap-x-2">
                            <li>
                                <ul role="list" class="flex justify-between gap-x-1">
                                    <li>
                                        <button
                                            type="button"
                                            class={`inline-flex text-white ${combo.attributes.nhom_combo === "On-Grid" ? "bg-red-600" : combo.attributes.nhom_combo === "Off-Grid" ? "bg-green-600" : "bg-gray-600"} items-center gap-x-1.5 rounded-lg px-2.5 py-1.5 xl:text-sm text-md font-semibold shadow-sm hover:${combo.attributes.nhom_combo === "On-Grid" ? "bg-red-600" : combo.attributes.nhom_combo === "Off-Grid" ? "bg-green-600" : "bg-gray-600"} focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-${combo.attributes.nhom_combo === "On-Grid" ? "red-600" : combo.attributes.nhom_combo === "Off-Grid" ? "green-600" : "gray-600"}`}
                                        >
                                            {combo.attributes.nhom_combo}
                                        </button>
                                    </li>
                                    <li>
                                        <button
                                            type="button"
                                            class={`inline-flex items-center gap-x-1.5 rounded-lg px-2.5 py-1.5 xl:text-sm text-md font-semibold text-white shadow-sm ${
                                                combo.attributes.pha === "1 pha"
                                                    ? "bg-blue-600 hover:bg-blue-600 focus-visible:outline-blue-600"
                                                    : combo.attributes.pha === "3 pha" ||
                                                      combo.attributes.pha === "3 pha áp thấp"
                                                    ? "bg-orange-500 hover:bg-orange-500 focus-visible:outline-orange-600"
                                                    : combo.attributes.pha === "3 pha áp cao"
                                                    ? "bg-red-500 hover:bg-red-500 focus-visible:outline-red-600"
                                                    : "bg-gray-600 hover:bg-gray-600 focus-visible:outline-gray-600"
                                            } focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2`}
                                        >
                                            {combo.attributes.pha}
                                        </button>
                                    </li>
                                </ul>
                            </li>
                            <li>
                                <button type="button" class="px-2.5 py-1.5 xl:text-xl text-xl font-semibold">
                                    {combo.attributes.cong_suat} kW
                                </button>
                            </li>
                        </ul>
                        <a href={`/goi-san-pham/${combo.attributes.slug}/`}>
                            <img
                                class="rounded-2xl mx-auto aspect-[265/200] w-full"
                                src={combo.attributes.image.data.attributes.formats.small.url}
                                alt={combo.attributes.tilte}
                            />
                        </a>

                        <div class="w-full bg-slate-100 px-6 my-6 rounded-2xl text-center py-1.5">
                            <span>Giá niêm yết T{month}/{year}</span>
                            <h3
                                class={`text-3xl font-semibold ${
                                    combo.attributes.nhom_combo === "On-Grid"
                                        ? "text-red-600"
                                        : combo.attributes.nhom_combo === "Off-Grid"
                                        ? "text-green-600"
                                        : "text-gray-600"
                                }`}
                            >
                                {formatCurrency(combo.attributes.gia_niem_yet)}
                                <sup>đ</sup>
                            </h3>
                        </div>
                        <div class="divide-y divide-gray-100 text-sm leading-6">
                            <ul role="list" class="mt-2 flex justify-between gap-x-6">
                                <li>
                                    <h3 class="xl:text-lg text-xl font-semibold leading-7 tracking-tight">Công suất:</h3>
                                </li>
                                <li>
                                    <p class="xl:text-lg text-xl font-semibold leading-6">{combo.attributes.cong_suat} kW</p>
                                </li>
                            </ul>
                            <ul role="list" class="mt-2 flex justify-between gap-x-6">
                                <li>
                                    <h3 class="xl:text-lg text-xl font-semibold leading-7 tracking-tight">Hệ điện:</h3>
                                </li>
                                <li>
                                    <p class="xl:text-lg text-xl leading-6">{combo.attributes.pha}</p>
                                </li>
                            </ul>
                            <ul role="list" class="mt-2 flex justify-between gap-x-6">
                                <li>
                                    <h3 class="xl:text-lg text-xl text-nowrap font-semibold leading-7 tracking-tight">Sản lượng:</h3>
                                </li>
                                <li>
                                    <p class="xl:text-lg text-xl text-right leading-6">
                                        {combo.attributes.san_luong}
                                        <br />
                                        kwh/tháng
                                    </p>
                                </li>
                            </ul>
                            <ul role="list" class="mt-2 flex justify-between gap-x-6">
                                <li>
                                    <h3 class="xl:text-lg text-xl font-semibold leading-7 tracking-tight">Hoàn vốn:</h3>
                                </li>
                                <li>
                                    <p class="xl:text-lg text-xl leading-6">{combo.attributes.hoan_von}</p>
                                </li>
                            </ul>
                            <ul role="list" class="mt-2 flex justify-between gap-x-6">
                                <li>
                                    <h3 class="xl:text-lg text-xl font-semibold leading-7 tracking-tight">Diện tích lắp đặt:</h3>
                                </li>
                                <li>
                                    <p class="xl:text-lg text-xl leading-6">
                                        {combo.attributes.dien_tich} m<sup>2</sup>
                                    </p>
                                </li>
                            </ul>
                        </div>
                        <ul role="list" class="mt-6 flex justify-between gap-x-3">
                            <li class="w-2/3">
                                <a href={`/goi-san-pham/${combo.attributes.slug}/`}>
                                    <button
                                        type="button"
                                        class={`w-full xl:text-lg inline-flex ${
                                            combo.attributes.nhom_combo === "On-Grid"
                                                ? "bg-white border-red-600 text-red-600"
                                                : combo.attributes.nhom_combo === "Off-Grid"
                                                ? "bg-white border-green-600 text-green-600"
                                                : "bg-gray-600 border-gray-600"
                                        } items-center gap-x-1.5 rounded-xl border-2 px-2.5 py-1.5 text-lg font-semibold justify-center`}
                                    >
                                        Chi tiết cấu hình
                                    </button>
                                </a>
                            </li>
                            <li class="w-1/3">
                                <a href={`https://zalo.me/${zalo}`} target="_blank">
                                    <button
                                        type="button"
                                        class={`w-full xl:text-lg inline-flex items-center gap-x-1.5 rounded-xl border-2 px-2.5 py-1.5 text-lg font-semibold text-white justify-center ${
                                            combo.attributes.nhom_combo === "On-Grid"
                                                ? "bg-red-600 border-red-600"
                                                : combo.attributes.nhom_combo === "Off-Grid"
                                                ? "bg-green-600 border-green-600"
                                                : "bg-gray-600 border-gray-600"
                                        }`}
                                    >
                                        Liên hệ
                                    </button>
                                </a>
                            </li>
                        </ul>
                    </li>
                    {combo.attributes.nhom_combo === "Off-Grid" && index === 2 && (
                       <ul class="pt-6 block lg:hidden md:hidden sm:block">
                           <li >
                            <img src="/images/banner-pincaoap.jpg" alt="Off-Grid Banner"  />
                            </li>   
                            </ul>
                    )}
                </div>
            ))}
            </ul>
        </div>
    </div>
</div>
